@model AdoptameLiberia.Models.Inventario.HistorialInventario
@{
    ViewBag.Title = "Historial de movimientos";
}

<h2>Historial de movimientos</h2>

<p class="text-muted">
    Puedes filtrar por usuario (email) y/o por rango de fechas.
</p>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

<div class="panel panel-default">
    <div class="panel-heading"><strong>Filtros</strong></div>
    <div class="panel-body">
        @using (Html.BeginForm("Historial", "Inventario", FormMethod.Get, new { @class = "form-horizontal" }))
        {
            <div class="form-group">
                <label class="control-label col-md-2">Usuario (email)</label>
                <div class="col-md-4">
                    <input type="text" name="UsuarioEmail" value="@Model.Filter.UsuarioEmail" class="form-control" placeholder="Ej: admin@correo.com" />
                </div>

                <label class="control-label col-md-2">Desde</label>
                <div class="col-md-2">
                    <input type="date" name="Desde" value="@(Model.Filter.Desde.HasValue ? Model.Filter.Desde.Value.ToString("yyyy-MM-dd") : "")" class="form-control" />
                </div>

                <label class="control-label col-md-1">Hasta</label>
                <div class="col-md-1">
                    <input type="date" name="Hasta" value="@(Model.Filter.Hasta.HasValue ? Model.Filter.Hasta.Value.ToString("yyyy-MM-dd") : "")" class="form-control" />
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                    <button type="submit" class="btn btn-primary">Buscar</button>
                    @Html.ActionLink("Limpiar", "Historial", "Inventario", null, new { @class = "btn btn-default" })
                    @Html.ActionLink("Volver al inventario", "Index", "Inventario", null, new { @class = "btn btn-link" })
                </div>
            </div>
        }
    </div>
</div>

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Artículo</th>
            <th>Tipo</th>
            <th>Cantidad</th>
            <th>Stock anterior</th>
            <th>Stock nuevo</th>
            <th>Destinatario/Uso</th>
            <th>Motivo</th>
            <th>Usuario</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var m in Model.Movimientos)
    {
        <tr>
            <td>@m.Fecha.ToString("yyyy-MM-dd HH:mm")</td>
            <td>@m.Item</td>
            <td>
                @m.Tipo
                @if (m.Tipo == "Ajuste")
                {
                    <span class="label label-info" style="margin-left:6px;">Auditoría</span>
                }
            </td>
            <td>@m.Cantidad</td>
            <td>@(m.StockAnterior.HasValue ? m.StockAnterior.Value.ToString() : "—")</td>
            <td>@(m.StockNuevo.HasValue ? m.StockNuevo.Value.ToString() : "—")</td>
            <td>@(string.IsNullOrWhiteSpace(m.Destinatario) ? "—" : m.Destinatario)</td>
            <td>@(string.IsNullOrWhiteSpace(m.Motivo) ? "—" : m.Motivo)</td>
            <td>@m.UsuarioEmail</td>
        </tr>
    }
    </tbody>
</table>
